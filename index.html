<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>تقرير نتائج الفيزياء 1 - شعبة 2 (الفصل الثاني)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 20px;
      background-color: #f9f9f9;
    }
    .card {
      width: 90%;
      margin: 10px auto;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow-x: auto;
    }
    .card h2 {
      font-size: 1.3em;
      margin-bottom: 10px;
      text-align: right;
      color: #2c3e50;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px 12px;
      text-align: center;
      white-space: nowrap;
    }
    th {
      background-color: #eef0f2;
    }
    canvas {
      max-width: 100%;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>
<body>
  <h1 style="text-align:center; color:#34495e;">تقرير إحصائي – الفيزياء 1 (شعبة 2)</h1>
  <div class="card" id="loadingCard">
    <h2>تحميل البيانات</h2>
    <p>انتظر لحظة... يتم تحميل البيانات من ملف JSON وعرضها ديناميكيًا.</p>
  </div>

  <!-- البطاقة 1 -->
  <div class="card" id="statsCard" style="display:none;">
    <h2>البطاقة 1: إحصائية مفصلة للفترتين</h2>
    <table>
      <thead>
        <tr><th>المؤشر الإحصائي</th><th>الفترة الأولى</th><th>نهاية الفصل</th></tr>
      </thead>
      <tbody id="statsTableBody"></tbody>
    </table>
  </div>

  <!-- البطاقة 2 -->
  <div class="card" id="chartCard" style="display:none;">
    <h2>البطاقة 2: مقارنة الإحصائيات في الفترتين (رسم بياني عمودي)</h2>
    <canvas id="comparisonChart"></canvas>
  </div>

  <!-- البطاقة 3 -->
  <div class="card" id="gradeDistCard" style="display:none;">
    <h2>البطاقة 3: توزيع الطلاب حسب التقدير</h2>
    <table>
      <thead>
        <tr><th>الرمز</th><th>التقدير</th><th>النطاق</th><th>عدد الطلاب</th><th>النسبة المئوية</th></tr>
      </thead>
      <tbody id="gradeTableBody"></tbody>
    </table>
  </div>

  <!-- البطاقة 4 -->
  <div class="card" id="doughnutCard" style="display:none;">
    <h2>البطاقة 4: الرسم الكعكي لتوزيع الطلاب حسب التقدير</h2>
    <canvas id="gradeDoughnutChart"></canvas>
  </div>

  <script>
    async function loadData() {
      const response = await fetch('grades_sh2_term2_with_total_and_grade.json');
      const data = await response.json();
      document.getElementById("loadingCard").style.display = "none";

      const period1 = data.map(s => s["period1_total"]);
      const final = data.map(s => s["final_practical"] + s["final_written"]);

      function mean(arr) {
        return arr.reduce((a,b)=>a+b,0) / arr.length;
      }
      function median(arr) {
        const sorted = [...arr].sort((a,b)=>a-b);
        const mid = Math.floor(sorted.length/2);
        return sorted.length % 2 === 0 ? (sorted[mid-1]+sorted[mid])/2 : sorted[mid];
      }
      function mode(arr) {
        const freq = {};
        arr.forEach(v => freq[v] = (freq[v]||0)+1);
        const maxFreq = Math.max(...Object.values(freq));
        const modes = Object.entries(freq).filter(([_,v])=>v===maxFreq).map(([k])=>parseFloat(k));
        return modes[0];
      }
      function stddev(arr, avg) {
        const variance = arr.reduce((a,b)=>a + Math.pow(b-avg,2), 0) / arr.length;
        return Math.sqrt(variance);
      }

      const p1_mean = mean(period1);
      const f_mean = mean(final);
      const p1_std_raw = stddev(period1, p1_mean);
      const f_std_raw = stddev(final, f_mean);
      const p1_std = p1_std_raw.toFixed(2);
      const f_std = f_std_raw.toFixed(2);
      const p1_var = (p1_std_raw * p1_std_raw).toFixed(2);
      const f_var = (f_std_raw * f_std_raw).toFixed(2);
      const p1_median = median(period1).toFixed(2);
      const f_median = median(final).toFixed(2);
      const p1_mode = mode(period1);
      const f_mode = mode(final);

      const statsBody = document.getElementById("statsTableBody");
      const rows = [
        ["عدد الطلاب", period1.length, final.length],
        ["مجموع الدرجات", period1.reduce((a,b)=>a+b,0).toFixed(2), final.reduce((a,b)=>a+b,0).toFixed(2)],
        ["المتوسط الحسابي", p1_mean.toFixed(2), f_mean.toFixed(2)],
        ["الوسيط", p1_median, f_median],
        ["المنوال", p1_mode, f_mode],
        ["الانحراف المعياري", p1_std, f_std],
        ["التباين", p1_var, f_var],
      ];
      rows.forEach(([label,p1,f]) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${label}</td><td>${p1}</td><td>${f}</td>`;
        statsBody.appendChild(tr);
      });
      document.getElementById("statsCard").style.display = "block";

      // البطاقة 2: رسم بياني
      const ctx = document.getElementById("comparisonChart").getContext("2d");
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ["المتوسط الحسابي", "الوسيط", "المنوال", "الانحراف المعياري", "التباين"],
          datasets: [
            {
              label: "الفترة الأولى",
              data: [p1_mean, p1_median, p1_mode, p1_std, p1_var],
              backgroundColor: 'rgba(52, 152, 219, 0.7)'
            },
            {
              label: "نهاية الفصل",
              data: [f_mean, f_median, f_mode, f_std, f_var],
              backgroundColor: 'rgba(231, 76, 60, 0.7)'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: 'top' } },
          scales: { y: { beginAtZero: true } }
        }
      });
      document.getElementById("chartCard").style.display = "block";

      // البطاقة 3 و 4: توزيع الطلاب حسب التقدير
      const gradeCounts = {};
      data.forEach(s => {
        const grade = s["التقدير"] || "غير محدد";
        gradeCounts[grade] = (gradeCounts[grade] || 0) + 1;
      });

      const gradeTableBody = document.getElementById("gradeTableBody");
      const totalStudents = data.length;
      const orderedGrades = [
        { grade: "ممتاز مرتفع", symbol: "+A", range: "100 - 95" },
        { grade: "ممتاز", symbol: "A", range: "94 - 90" },
        { grade: "جيد جدًا مرتفع", symbol: "+B", range: "89 - 85" },
        { grade: "جيد جدًا", symbol: "B", range: "84 - 80" },
        { grade: "جيد مرتفع", symbol: "+C", range: "79 - 75" },
        { grade: "جيد", symbol: "C", range: "74 - 70" },
        { grade: "مقبول مرتفع", symbol: "+D", range: "69 - 65" },
        { grade: "مقبول", symbol: "D", range: "64 - 60" },
        { grade: "ضعيف", symbol: "F", range: "59 وأقل" }
      ];

      const labels = [];
      const values = [];
      const colors = [
        '#1abc9c','#2ecc71','#3498db','#9b59b6','#f1c40f','#e67e22','#e74c3c','#95a5a6','#34495e'
      ];

      orderedGrades.forEach(({grade, symbol, range}, idx) => {
        const count = gradeCounts[grade] || 0;
        const percent = ((count / totalStudents) * 100).toFixed(1) + "%";
        labels.push(grade);
        values.push(count);
        const row = `<tr><td>${symbol}</td><td>${grade}</td><td>${range}</td><td>${count}</td><td>${percent}</td></tr>`;
        gradeTableBody.innerHTML += row;
      });
      document.getElementById("gradeDistCard").style.display = "block";

      const doughnutCtx = document.getElementById("gradeDoughnutChart").getContext("2d");
      new Chart(doughnutCtx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: values,
            backgroundColor: colors
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
      document.getElementById("doughnutCard").style.display = "block";
    }

    loadData();
  </script>


  
  <!-- البطاقة 5 -->
  <div class="card" id="studentsTableCard" style="display:none;">
    <h2>البطاقة 5: جدول تفصيلي لدرجات الطلاب</h2>
    <table>
      <thead>
        <tr>
          <th>اسم الطالب</th>
          <th>الواجبات</th>
          <th>المشاريع</th>
          <th>النشاطات</th>
          <th>المشاركة</th>
          <th>اختبارات قصيرة</th>
          <th>تطبيق عملي</th>
          <th>مجموع الفترة الأولى</th>
          <th>النهائي العملي</th>
          <th>النهائي التحريري</th>
          <th>مجموع نهاية الفصل</th>
          <th>المجموع الكلي</th>
          <th>التقدير</th>
        </tr>
      </thead>
      <tbody id="studentsTableBody"></tbody>
    </table>
  </div>

  <script>
    async function loadData() {
      const response = await fetch('grades_sh2_term2_with_total_and_grade.json');
      const data = await response.json();
      document.getElementById("loadingCard").style.display = "none";

      // البيانات الأخرى...

      // البطاقة 5: جدول درجات الطلاب
      const studentsBody = document.getElementById("studentsTableBody");
      data.forEach(s => {
        const finalTotal = (s["final_practical"] + s["final_written"]).toFixed(2);
        const row = `<tr>
          <td>${s.student_name}</td>
          <td>${s.assignments}</td>
          <td>${s.projects}</td>
          <td>${s.activities}</td>
          <td>${s.participation}</td>
          <td>${s.short_written}</td>
          <td>${s.short_practical}</td>
          <td>${s.period1_total}</td>
          <td>${s.final_practical}</td>
          <td>${s.final_written}</td>
          <td>${finalTotal}</td>
          <td>${s.total_score}</td>
          <td>${s["التقدير"]}</td>
        </tr>`;
        studentsBody.innerHTML += row;
      });
      document.getElementById("studentsTableCard").style.display = "block";
    }

    loadData();
  </script>


    <!-- البطاقة 6 -->
  <div class="card" id="histPeriod1Card" style="display:none;">
    <h2>البطاقة 6: توزيع درجات الفترة الأولى مقارنة بالمنحنى الطبيعي</h2>
    <div id="period1Histogram" style="height:400px;"></div>
  </div>

  <script>
    async function loadData() {
      const response = await fetch('grades_sh2_term2_with_total_and_grade.json');
      const data = await response.json();

      const period1 = data.map(s => s["period1_total"]);
      const mean = period1.reduce((a,b)=>a+b,0) / period1.length;
      const std = Math.sqrt(period1.reduce((a,b)=>a + Math.pow(b - mean,2), 0) / period1.length);

      const normalDist = Array.from({length: 100}, (_, i) => {
        const x = i;
        const fx = (1 / (std * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mean) / std, 2));
        return {x, y: fx * 1000};
      });

      const trace1 = {
        x: period1,
        type: 'histogram',
        opacity: 0.6,
        name: 'الفترة الأولى'
      };
      const trace2 = {
        x: normalDist.map(p => p.x),
        y: normalDist.map(p => p.y),
        type: 'scatter',
        mode: 'lines',
        name: 'التوزيع الطبيعي'
      };
      const layout = {
        barmode: 'overlay',
        xaxis: {title: 'الدرجات'},
        yaxis: {title: 'عدد الطلاب'},
        legend: {orientation: 'h'}
      };

      Plotly.newPlot('period1Histogram', [trace1, trace2], layout);
      document.getElementById("histPeriod1Card").style.display = "block";
    }

    loadData();
  </script>


  <!-- البطاقة 7 -->
  <div class="card" id="histFinalCard" style="display:none;">
    <h2>البطاقة 7: توزيع درجات نهاية الفصل مقارنة بالمنحنى الطبيعي</h2>
    <div id="finalHistogram" style="height:400px;"></div>
  </div>

  <script>
    async function loadData() {
      const response = await fetch('grades_sh2_term2_with_total_and_grade.json');
      const data = await response.json();

      const final = data.map(s => s["final_practical"] + s["final_written"]);
      const mean = final.reduce((a,b)=>a+b,0) / final.length;
      const std = Math.sqrt(final.reduce((a,b)=>a + Math.pow(b - mean,2), 0) / final.length);

      const normalDist = Array.from({length: 100}, (_, i) => {
        const x = i;
        const fx = (1 / (std * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mean) / std, 2));
        return {x, y: fx * 1000};
      });

      const trace1 = {
        x: final,
        type: 'histogram',
        opacity: 0.6,
        name: 'نهاية الفصل'
      };
      const trace2 = {
        x: normalDist.map(p => p.x),
        y: normalDist.map(p => p.y),
        type: 'scatter',
        mode: 'lines',
        name: 'التوزيع الطبيعي'
      };
      const layout = {
        barmode: 'overlay',
        xaxis: {title: 'الدرجات'},
        yaxis: {title: 'عدد الطلاب'},
        legend: {orientation: 'h'}
      };

      Plotly.newPlot('finalHistogram', [trace1, trace2], layout);
      document.getElementById("histFinalCard").style.display = "block";
    }

    loadData();
  </script>
  

  <div class="card" id="compareHistCard" style="display:none;">
    <h2>البطاقة 8: مقارنة التوزيع الفعلي والمنحنى الطبيعي للفترتين</h2>
    <div id="compareHistogram" style="height:500px;"></div>
  </div>

  <script>
    async function loadData() {
      const response = await fetch('grades_sh2_term2_with_total_and_grade.json');
      const data = await response.json();

      const period1 = data.map(s => s["period1_total"]);
      const final = data.map(s => s["final_practical"] + s["final_written"]);

      function getNormalDistribution(arr) {
        const mean = arr.reduce((a,b)=>a+b,0) / arr.length;
        const std = Math.sqrt(arr.reduce((a,b)=>a + Math.pow(b - mean,2), 0) / arr.length);
        const min = Math.min(...arr);
        const max = Math.max(...arr);
        const points = [];
        for (let x = min - 5; x <= max + 5; x += 0.5) {
          const fx = (1 / (std * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mean) / std, 2));
          points.push({x, y: fx * arr.length * 2});
        }
        return points;
      }

      const period1Normal = getNormalDistribution(period1);
      const finalNormal = getNormalDistribution(final);

      const traceP1 = {
        x: period1,
        type: 'histogram',
        opacity: 0.5,
        name: 'الفترة الأولى',
        marker: {color: 'rgba(52,152,219,0.7)'}
      };
      const traceF = {
        x: final,
        type: 'histogram',
        opacity: 0.5,
        name: 'نهاية الفصل',
        marker: {color: 'rgba(231,76,60,0.7)'}
      };
      const traceP1Norm = {
        x: period1Normal.map(p => p.x),
        y: period1Normal.map(p => p.y),
        type: 'scatter',
        mode: 'lines',
        name: 'منحنى الفترة الأولى',
        line: {color: 'blue'}
      };
      const traceFNorm = {
        x: finalNormal.map(p => p.x),
        y: finalNormal.map(p => p.y),
        type: 'scatter',
        mode: 'lines',
        name: 'منحنى نهاية الفصل',
        line: {color: 'red'}
      };

      const layout = {
        barmode: 'overlay',
        xaxis: {title: 'الدرجات'},
        yaxis: {title: 'عدد الطلاب'},
        legend: {orientation: 'h'}
      };

      Plotly.newPlot('compareHistogram', [traceP1, traceF, traceP1Norm, traceFNorm], layout);
      document.getElementById("compareHistCard").style.display = "block";
    }

    loadData();
  </script>
</body>
</html>
