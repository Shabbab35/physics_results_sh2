<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>تقرير نتائج الفيزياء 1 - شعبة 2 (الفصل الثاني)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 20px;
      background-color: #f9f9f9;
    }
    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      overflow-x: auto;
    }
    .main-card {
      width: 95%;
      margin: auto;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      padding: 10px;
    }
    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
    h2, h3 {
      text-align: right;
      color: #2c3e50;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #eef0f2;
    }
    canvas {
      max-width: 100%;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>
<body>
  <h1 style="text-align:center; color:#34495e;">تقرير إحصائي – الفيزياء 1 (شعبة 2)</h1>

  <div class="card" id="loadingCard">
    <h2>تحميل البيانات</h2>
    <p>انتظر لحظة... يتم تحميل البيانات من ملف JSON وعرضها ديناميكيًا.</p>
  </div>

  <!-- البطاقة 1 -->
  <div class="card" id="statsCard" style="display:none;">
    <h2>البطاقة 1: إحصائية مفصلة للفترتين</h2>
    <table>
      <thead>
        <tr><th>المؤشر الإحصائي</th><th>الفترة الأولى</th><th>نهاية الفصل</th></tr>
      </thead>
      <tbody id="statsTableBody"></tbody>
    </table>
  </div>



  <!-- البطاقة 2 -->
<div class="card" id="chartCard" style="display:none;">
  <h2>البطاقة 2: مقارنة الإحصائيات في الفترتين (رسم بياني عمودي - نسبة مئوية)</h2>
  <canvas id="comparisonChart"></canvas>
</div>
 


  <!-- البطاقة 3 -->
  <div class="card" id="gradeDistCard" style="display:none;">
    <h2>البطاقة 3: توزيع الطلاب حسب التقدير</h2>
    <table>
      <thead>
        <tr><th>الرمز</th><th>التقدير</th><th>النطاق</th><th>عدد الطلاب</th><th>النسبة المئوية</th></tr>
      </thead>
      <tbody id="gradeTableBody"></tbody>
    </table>
  </div>

  <!-- البطاقة 4 -->
  <div class="card" id="doughnutCard" style="display:none;">
    <h2>البطاقة 4: الرسم الكعكي لتوزيع الطلاب حسب التقدير</h2>
    <canvas id="gradeDoughnutChart"></canvas>
  </div>

  <script>
    async function loadData() {
      const response = await fetch('grades_sh2_term2_with_total_and_grade.json');
      const data = await response.json();
      document.getElementById("loadingCard").style.display = "none";

      const period1 = data.map(s => s["period1_total"]);
      const final = data.map(s => s["final_practical"] + s["final_written"]);

      function mean(arr) {
        return arr.reduce((a,b)=>a+b,0) / arr.length;
      }
      function median(arr) {
        const sorted = [...arr].sort((a,b)=>a-b);
        const mid = Math.floor(sorted.length/2);
        return sorted.length % 2 === 0 ? (sorted[mid-1]+sorted[mid])/2 : sorted[mid];
      }
      function mode(arr) {
        const freq = {};
        arr.forEach(v => freq[v] = (freq[v]||0)+1);
        const maxFreq = Math.max(...Object.values(freq));
        const modes = Object.entries(freq).filter(([_,v])=>v===maxFreq).map(([k])=>parseFloat(k));
        return modes[0];
      }
      function stddev(arr, avg) {
        const variance = arr.reduce((a,b)=>a + Math.pow(b-avg,2), 0) / arr.length;
        return Math.sqrt(variance);
      }

      const p1_mean = mean(period1);
      const f_mean = mean(final);
      const p1_std_raw = stddev(period1, p1_mean);
      const f_std_raw = stddev(final, f_mean);
      const p1_std = p1_std_raw.toFixed(2);
      const f_std = f_std_raw.toFixed(2);
      const p1_var = (p1_std_raw * p1_std_raw).toFixed(2);
      const f_var = (f_std_raw * f_std_raw).toFixed(2);
      const p1_median = median(period1).toFixed(2);
      const f_median = median(final).toFixed(2);
      const p1_mode = mode(period1);
      const f_mode = mode(final);

      const statsBody = document.getElementById("statsTableBody");
      const rows = [
        ["عدد الطلاب", period1.length, final.length],
        ["مجموع الدرجات", period1.reduce((a,b)=>a+b,0).toFixed(2), final.reduce((a,b)=>a+b,0).toFixed(2)],
        ["المتوسط الحسابي", p1_mean.toFixed(2), f_mean.toFixed(2)],
        ["الوسيط", p1_median, f_median],
        ["المنوال", p1_mode, f_mode],
        ["الانحراف المعياري", p1_std, f_std],
        ["التباين", p1_var, f_var],
      ];
      rows.forEach(([label,p1,f]) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${label}</td><td>${p1}</td><td>${f}</td>`;
        statsBody.appendChild(tr);
      });
      document.getElementById("statsCard").style.display = "block";

      // البطاقة 2: رسم بياني

      // إعداد بيانات المقارنة النسبية
const indicators = [
  { label: "المتوسط الحسابي", p1: p1_mean, f: f_mean },
  { label: "الوسيط", p1: p1_median, f: f_median },
  { label: "المنوال", p1: p1_mode, f: f_mode },
  { label: "الانحراف المعياري", p1: p1_std_raw, f: f_std_raw },
  { label: "التباين", p1: p1_var, f: f_var }
];

// التطبيع إلى نسبة مئوية
const maxVal = Math.max(...indicators.flatMap(ind => [ind.p1, ind.f]));
const labels = indicators.map(i => i.label);
const p1Data = indicators.map(i => ((i.p1 / maxVal) * 100).toFixed(2));
const fData = indicators.map(i => ((i.f / maxVal) * 100).toFixed(2));

// إنشاء الرسم
const ctx = document.getElementById("comparisonChart").getContext("2d");
new Chart(ctx, {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [
      {
        label: "الفترة الأولى",
        data: p1Data,
        backgroundColor: 'rgba(52, 152, 219, 0.7)'
      },
      {
        label: "نهاية الفصل",
        data: fData,
        backgroundColor: 'rgba(231, 76, 60, 0.7)'
      }
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'top' },
      tooltip: {
        callbacks: {
          label: ctx => ctx.dataset.label + ': ' + ctx.raw + '%'
        }
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        max: 100,
        ticks: {
          callback: function(value) {
            return value + '%';
          }
        },
        title: {
          display: true,
          text: 'النسبة المئوية (%)'
        }
      }
    }
  }
});
document.getElementById("chartCard").style.display = "block";





      
      // البطاقة 3 و 4: توزيع الطلاب حسب التقدير
      const gradeCounts = {};
      data.forEach(s => {
        const grade = s["التقدير"] || "غير محدد";
        gradeCounts[grade] = (gradeCounts[grade] || 0) + 1;
      });

      const gradeTableBody = document.getElementById("gradeTableBody");
      const totalStudents = data.length;
      const orderedGrades = [
        { grade: "ممتاز مرتفع", symbol: "+A", range: "100 - 95" },
        { grade: "ممتاز", symbol: "A", range: "94 - 90" },
        { grade: "جيد جدًا مرتفع", symbol: "+B", range: "89 - 85" },
        { grade: "جيد جدًا", symbol: "B", range: "84 - 80" },
        { grade: "جيد مرتفع", symbol: "+C", range: "79 - 75" },
        { grade: "جيد", symbol: "C", range: "74 - 70" },
        { grade: "مقبول مرتفع", symbol: "+D", range: "69 - 65" },
        { grade: "مقبول", symbol: "D", range: "64 - 60" },
        { grade: "ضعيف", symbol: "F", range: "59 وأقل" }
      ];

      const labels = [];
      const values = [];
      const colors = [
        '#1abc9c','#2ecc71','#3498db','#9b59b6','#f1c40f','#e67e22','#e74c3c','#95a5a6','#34495e'
      ];

      orderedGrades.forEach(({grade, symbol, range}, idx) => {
        const count = gradeCounts[grade] || 0;
        const percent = ((count / totalStudents) * 100).toFixed(1) + "%";
        labels.push(grade);
        values.push(count);
        const row = `<tr><td>${symbol}</td><td>${grade}</td><td>${range}</td><td>${count}</td><td>${percent}</td></tr>`;
        gradeTableBody.innerHTML += row;
      });
      document.getElementById("gradeDistCard").style.display = "block";

      const doughnutCtx = document.getElementById("gradeDoughnutChart").getContext("2d");
      new Chart(doughnutCtx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: values,
            backgroundColor: colors
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
      document.getElementById("doughnutCard").style.display = "block";
    }

    loadData();
  </script>


  
  <!-- البطاقة 5 -->
  <div class="card" id="studentsTableCard" style="display:none;">
    <h2>البطاقة 5: جدول تفصيلي لدرجات الطلاب</h2>
    <table>
      <thead>
        <tr>
          <th>اسم الطالب</th>
          <th>الواجبات</th>
          <th>المشاريع</th>
          <th>النشاطات</th>
          <th>المشاركة</th>
          <th>اختبارات قصيرة</th>
          <th>تطبيق عملي</th>
          <th>مجموع الفترة الأولى</th>
          <th>النهائي العملي</th>
          <th>النهائي التحريري</th>
          <th>مجموع نهاية الفصل</th>
          <th>المجموع الكلي</th>
          <th>التقدير</th>
        </tr>
      </thead>
      <tbody id="studentsTableBody"></tbody>
    </table>
  </div>

  <script>
    async function loadData() {
      const response = await fetch('grades_sh2_term2_with_total_and_grade.json');
      const data = await response.json();
      document.getElementById("loadingCard").style.display = "none";

      // البيانات الأخرى...

      // البطاقة 5: جدول درجات الطلاب
      const studentsBody = document.getElementById("studentsTableBody");
      data.forEach(s => {
        const finalTotal = (s["final_practical"] + s["final_written"]).toFixed(2);
        const row = `<tr>
          <td>${s.student_name}</td>
          <td>${s.assignments}</td>
          <td>${s.projects}</td>
          <td>${s.activities}</td>
          <td>${s.participation}</td>
          <td>${s.short_written}</td>
          <td>${s.short_practical}</td>
          <td>${s.period1_total}</td>
          <td>${s.final_practical}</td>
          <td>${s.final_written}</td>
          <td>${finalTotal}</td>
          <td>${s.total_score}</td>
          <td>${s["التقدير"]}</td>
        </tr>`;
        studentsBody.innerHTML += row;
      });
      document.getElementById("studentsTableCard").style.display = "block";
    }

    loadData();
  </script>

<!-- البطاقة 6 -->
<div class="card" id="histPeriod1Card" style="display:none;">
  <h2>البطاقة 6: توزيع درجات الفترة الأولى مقارنة بالمنحنى الطبيعي</h2>
  <div id="period1Histogram" style="height:400px; display: flex; justify-content: center;"></div>
</div>

<script>
  async function loadData() {
    const response = await fetch('grades_sh2_term2_with_total_and_grade.json');
    const data = await response.json();

    const period1 = data.map(s => s["period1_total"]);
    const mean = period1.reduce((a,b)=>a+b,0) / period1.length;
    const std = Math.sqrt(period1.reduce((a,b)=>a + Math.pow(b - mean,2), 0) / period1.length);

    const normalDist = Array.from({length: 100}, (_, i) => {
      const x = i;
      const fx = (1 / (std * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mean) / std, 2));
      return {x, y: fx};
    });

    const trace1 = {
      x: period1,
      type: 'histogram',
      histnorm: 'probability density',
      opacity: 0.6,
      name: 'الفترة الأولى',
      marker: {
        color: 'rgba(52,152,219,0.6)',
        line: {
          color: 'black',
          width: 1
        }
      }
    };

    const trace2 = {
      x: normalDist.map(p => p.x),
      y: normalDist.map(p => p.y),
      type: 'scatter',
      mode: 'lines',
      name: 'المنحنى الطبيعي'
    };

    const layout = {
      barmode: 'overlay',
      xaxis: {title: 'الدرجات'},
      yaxis: {title: 'الكثافة الاحتمالية'},
      legend: {orientation: 'h'}
    };

    Plotly.newPlot('period1Histogram', [trace1, trace2], layout);
    document.getElementById("histPeriod1Card").style.display = "block";
  }

  loadData();
</script>


 <!-- البطاقة 7 -->
<div class="card" id="histFinalCard" style="display:none;">
  <h2>البطاقة 7: توزيع درجات نهاية الفصل مقارنة بالمنحنى الطبيعي</h2>
  <div id="finalHistogram" style="height:400px; display: flex; justify-content: center;"></div>
</div>

<script>
  async function loadData() {
    const response = await fetch('grades_sh2_term2_with_total_and_grade.json');
    const data = await response.json();

    const final = data.map(s => s["final_practical"] + s["final_written"]);
    const mean = final.reduce((a,b)=>a+b,0) / final.length;
    const std = Math.sqrt(final.reduce((a,b)=>a + Math.pow(b - mean,2), 0) / final.length);

    const normalDist = Array.from({length: 100}, (_, i) => {
      const x = i;
      const fx = (1 / (std * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mean) / std, 2));
      return {x, y: fx};
    });

    const trace1 = {
      x: final,
      type: 'histogram',
      histnorm: 'probability density',
      opacity: 0.6,
      name: 'نهاية الفصل',
      marker: {
        color: 'rgba(231,76,60,0.6)',
        line: {
          color: 'black',
          width: 1
        }
      }
    };

    const trace2 = {
      x: normalDist.map(p => p.x),
      y: normalDist.map(p => p.y),
      type: 'scatter',
      mode: 'lines',
      name: 'المنحنى الطبيعي'
    };

    const layout = {
      barmode: 'overlay',
      xaxis: {title: 'الدرجات'},
      yaxis: {title: 'الكثافة الاحتمالية'},
      legend: {orientation: 'h'}
    };

    Plotly.newPlot('finalHistogram', [trace1, trace2], layout);
    document.getElementById("histFinalCard").style.display = "block";
  }

  loadData();
</script>
  
 <!-- البطاقة 8 -->
  <div class="card" id="compareHistCard" style="display:none;">
    <h2>البطاقة 8: مقارنة التوزيع الفعلي والمنحنى الطبيعي للفترتين</h2>
    <div id="compareHistogram" style="height:500px;"></div>
  </div>

  <script>
    async function loadData() {
      const response = await fetch('grades_sh2_term2_with_total_and_grade.json');
      const data = await response.json();

      const period1 = data.map(s => s["period1_total"]);
      const final = data.map(s => s["final_practical"] + s["final_written"]);

      function getNormalDistribution(arr) {
        const mean = arr.reduce((a,b)=>a+b,0) / arr.length;
        const std = Math.sqrt(arr.reduce((a,b)=>a + Math.pow(b - mean,2), 0) / arr.length);
        const min = Math.min(...arr);
        const max = Math.max(...arr);
        const points = [];
        for (let x = min - 5; x <= max + 5; x += 0.5) {
          const fx = (1 / (std * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mean) / std, 2));
          points.push({x, y: fx * arr.length * 2});
        }
        return points;
      }

      const period1Normal = getNormalDistribution(period1);
      const finalNormal = getNormalDistribution(final);

      const traceP1 = {
        x: period1,
        type: 'histogram',
        opacity: 0.5,
        name: 'الفترة الأولى',
        marker: {color: 'rgba(52,152,219,0.7)'}
      };
      const traceF = {
        x: final,
        type: 'histogram',
        opacity: 0.5,
        name: 'نهاية الفصل',
        marker: {color: 'rgba(231,76,60,0.7)'}
      };
      const traceP1Norm = {
        x: period1Normal.map(p => p.x),
        y: period1Normal.map(p => p.y),
        type: 'scatter',
        mode: 'lines',
        name: 'منحنى الفترة الأولى',
        line: {color: 'blue'}
      };
      const traceFNorm = {
        x: finalNormal.map(p => p.x),
        y: finalNormal.map(p => p.y),
        type: 'scatter',
        mode: 'lines',
        name: 'منحنى نهاية الفصل',
        line: {color: 'red'}
      };

      const layout = {
        barmode: 'overlay',
        xaxis: {title: 'الدرجات'},
        yaxis: {title: 'عدد الطلاب'},
        legend: {orientation: 'h'}
      };

      Plotly.newPlot('compareHistogram', [traceP1, traceF, traceP1Norm, traceFNorm], layout);
      document.getElementById("compareHistCard").style.display = "block";
    }

    loadData();
  </script>
  


  <!-- البطاقة 9 -->
  <div class="card" id="analysisCard" style="display:block;">
    <h2>البطاقة 9: التفسير الوصفي للإحصاءات</h2>
    <table>
      <thead>
        <tr>
          <th>المؤشر</th>
          <th>الفترة الأولى</th>
          <th>نهاية الفصل</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>المتوسط الحسابي</td>
          <td>أقل من نهاية الفصل، مما يشير إلى تحسن عام في الأداء</td>
          <td>أعلى من الفترة الأولى، مما يدل على تطور في التحصيل</td>
        </tr>
        <tr>
          <td>الوسيط</td>
          <td>متقارب مع المتوسط، مما يشير إلى توزيع شبه متماثل</td>
          <td>متوسط أعلى من الوسيط قليلًا، مما يدل على ميل طفيف للقيم العليا</td>
        </tr>
        <tr>
          <td>المنوال</td>
          <td>يتكرر عند القيم العالية (مثل 60)، مما يدل على أداء قوي لبعض الطلاب</td>
          <td>يتكرر في النطاق المتوسط، مما يعكس تنوع مستويات الطلاب</td>
        </tr>
        <tr>
          <td>الانحراف المعياري</td>
          <td>مرتفع نسبيًا، مما يشير إلى تشتت أكبر بين درجات الطلاب</td>
          <td>أقل من الفترة الأولى، مما يدل على تقارب أكثر في نتائج الطلاب</td>
        </tr>
        <tr>
          <td>التباين</td>
          <td>مرتفع ويعكس انتشارًا أكبر في البيانات</td>
          <td>منخفض نسبيًا مقارنة بالفترة الأولى</td>
        </tr>
      </tbody>
    </table>
    <p><strong>الاستنتاج:</strong> تشير الإحصاءات إلى أن أداء الطلاب في نهاية الفصل كان أفضل وأكثر تجانسًا مقارنة بالفترة الأولى، حيث تقلص التشتت وتحسن المتوسط العام للدرجات.</p>
  </div>


  

<!-- البطاقة 10 -->
<div class="card">
  <h2>البطاقة 10: تصنيف الطلاب حسب التقدير</h2>
  <div class="grid" id="gradeGroupContainer"></div>
</div>

<style>
  .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 32px;
    padding: 20px;
  }
  @media (max-width: 768px) {
    .grid {
      grid-template-columns: 1fr;
    }
  }
  .grid .card {
    width: 100%;
    margin: 0;
    padding: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    border: 1px solid #ccc;
    border-radius: 8px;
    background-color: #fff;
    box-sizing: border-box;
  }
  .grade-header {
    color: #fff;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 15px;
    font-size: 1.1em;
    text-align: center;
  }
</style>

<script>
  async function loadData() {
    const response = await fetch("grades_sh2_term2_with_total_and_grade.json");
    const data = await response.json();

    const container = document.getElementById("gradeGroupContainer");

    const groups = [
      {
        label: "الطلاب الحاصلين على تقدير ممتاز",
        values: ["ممتاز مرتفع", "ممتاز"],
        color: "#2ecc71"
      },
      {
        label: "الطلاب الحاصلين على تقدير جيد جدًا",
        values: ["جيد جدًا مرتفع", "جيد جدًا"],
        color: "#3498db"
      },
      {
        label: "الطلاب الحاصلين على تقدير جيد",
        values: ["جيد مرتفع", "جيد"],
        color: "#f1c40f"
      },
      {
        label: "الطلاب الحاصلين على تقدير مقبول",
        values: ["مقبول مرتفع", "مقبول"],
        color: "#e67e22"
      },
      {
        label: "الطلاب الحاصلين على تقدير ضعيف",
        values: ["ضعيف"],
        color: "#e74c3c"
      }
    ];

    groups.forEach(group => {
      const students = data.filter(s => group.values.includes(s["التقدير"]));
      if (students.length > 0) {
        const card = document.createElement("div");
        card.className = "card";
        card.style.margin = "0 auto";

        const title = document.createElement("div");
        title.className = "grade-header";
        title.style.backgroundColor = group.color;
        title.textContent = group.label;

        const table = document.createElement("table");
        table.innerHTML = `
          <thead><tr><th>م</th><th>اسم الطالب</th></tr></thead>
          <tbody>
            ${students.map((s, i) => `<tr><td>${i + 1}</td><td>${s.student_name}</td></tr>`).join("")}
          </tbody>
        `;

        card.appendChild(title);
        card.appendChild(table);
        container.appendChild(card);
      }
    });
  }

  loadData();
</script>





<!-- البطاقة 11 -->
<div class="card" id="pieGradeCard" style="display:none;">
  <h2>البطاقة 11: النسبة المئوية لتوزيع الطلاب حسب التقدير</h2>
  <canvas id="gradePieChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<script>
  async function loadData() {
    const response = await fetch("grades_sh2_term2_with_total_and_grade.json");
    const data = await response.json();

    const groups = [
      {
        title: "ممتاز",
        values: ["ممتاز مرتفع", "ممتاز"],
        color: "#2ecc71"
      },
      {
        title: "جيد جدًا",
        values: ["جيد جدًا مرتفع", "جيد جدًا"],
        color: "#3498db"
      },
      {
        title: "جيد",
        values: ["جيد مرتفع", "جيد"],
        color: "#f1c40f"
      },
      {
        title: "مقبول",
        values: ["مقبول مرتفع", "مقبول"],
        color: "#e67e22"
      },
      {
        title: "ضعيف",
        values: ["ضعيف"],
        color: "#e74c3c"
      }
    ];

    const labels = [];
    const values = [];
    const colors = [];

    groups.forEach(group => {
      const count = data.filter(s => group.values.includes(s["التقدير"])).length;
      if (count > 0) {
        labels.push(group.title);
        values.push(count);
        colors.push(group.color);
      }
    });

    const total = values.reduce((a, b) => a + b, 0);

    const pieCtx = document.getElementById("gradePieChart").getContext("2d");
    new Chart(pieCtx, {
      type: 'pie',
      data: {
        labels: labels,
        datasets: [{
          data: values,
          backgroundColor: colors
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          datalabels: {
            formatter: (value, context) => {
              const percentage = ((value / total) * 100).toFixed(1);
              return percentage + '%';
            },
            color: '#fff',
            font: {
              weight: 'bold',
              size: 14
            }
          }
        }
      },
      plugins: [ChartDataLabels]
    });

    document.getElementById("pieGradeCard").style.display = "block";
  }

  loadData();
</script>


  <!-- البطاقة 12 -->
<div class="card" id="nationalityCard" style="display:none;">
  <h2>البطاقة 12: توزيع الطلاب حسب الجنسية</h2>
  <canvas id="nationalityDoughnutChart"></canvas>
</div>

<script>
  async function loadData() {
    const response = await fetch("grades_sh2_term2_with_total_and_grade.json");
    const data = await response.json();

    const nationalityCounts = { سعودي: 0, "غير سعودي": 0 };
    data.forEach(s => {
      const isSaudi = s.student_id.toString().startsWith("1");
      const label = isSaudi ? "سعودي" : "غير سعودي";
      nationalityCounts[label]++;
    });

    const labels = Object.keys(nationalityCounts);
    const values = Object.values(nationalityCounts);
    const colors = ['#2980b9', '#16a085'];

    const ctx = document.getElementById("nationalityDoughnutChart").getContext("2d");
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: labels,
        datasets: [{
          data: values,
          backgroundColor: colors
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          tooltip: {
            callbacks: {
              label: function(context) {
                const total = values.reduce((a,b)=>a+b,0);
                const percentage = ((context.parsed / total) * 100).toFixed(1);
                return `${context.label}: ${context.parsed} (${percentage}%)`;
              }
            }
          }
        }
      }
    });

    document.getElementById("nationalityCard").style.display = "block";
  }

  loadData();
</script>


</body>
</html>
